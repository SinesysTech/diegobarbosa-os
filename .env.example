# =============================================================================
# SINESYS - Variáveis de Ambiente
# =============================================================================
# Copie este arquivo para .env.local e preencha os valores
#
# cp .env.example .env.local
# =============================================================================

# -----------------------------------------------------------------------------
# SUPABASE (Obrigatórias)
# -----------------------------------------------------------------------------
NEXT_PUBLIC_SUPABASE_URL=https://seu-projeto.supabase.co
NEXT_PUBLIC_SUPABASE_PUBLISHABLE_OR_ANON_KEY=sua_anon_key
SUPABASE_SECRET_KEY=sua_secret_key

# Supabase Management API (para métricas de Disk IO Budget)
# Obtenha o project_ref da URL (ex: https://abcdefgh.supabase.co → abcdefgh)
# Gere o access_token em: https://supabase.com/dashboard/account/tokens
SUPABASE_PROJECT_REF=seu_project_ref
SUPABASE_ACCESS_TOKEN=seu_access_token

# -----------------------------------------------------------------------------
# AUTENTICAÇÃO DE SISTEMA (Obrigatória)
# -----------------------------------------------------------------------------
# Chave para autenticação entre serviços internos
SERVICE_API_KEY=sua_api_key_segura

# -----------------------------------------------------------------------------
# STORAGE - Backblaze B2 (Opcional)
# -----------------------------------------------------------------------------
# As seguintes integrações são configuradas via UI em /app/configuracoes?tab=integracoes
# e armazenadas na tabela 'integracoes' do Supabase:
#   - 2FAuth (autenticação OTP)
#   - Chatwoot (comunicação com clientes)
#   - Dyte (videoconferência)
# Não é necessário definir variáveis de ambiente para estas integrações.

# -----------------------------------------------------------------------------
# AI - CopilotKit e Google Gemini (Opcional)
# -----------------------------------------------------------------------------
# CopilotKit Cloud - Assistente IA
COPILOT_CLOUD_PUBLIC_API_KEY=sua_chave_copilotkit

# Google API Key - Gemini e outros servicos Google
# Obtenha em: https://aistudio.google.com/app/apikey
GOOGLE_API_KEY=sua_chave_google_api

# -----------------------------------------------------------------------------
# AI GATEWAY - Editor de Documentos Plate.js (Obrigatoria para IA do Editor)
# -----------------------------------------------------------------------------
# Chave de API do AI Gateway (Vercel AI Gateway ou similar)
# Usada para funcionalidades de IA no editor de documentos (gerar, editar, comentar)
# Com system prompts especializados em Direito Brasileiro
# Obtenha em: https://vercel.com/docs/ai-gateway
AI_GATEWAY_API_KEY=sua_chave_ai_gateway

# -----------------------------------------------------------------------------
# OPENAI - Embeddings para RAG (Obrigatória para Busca Semântica)
# -----------------------------------------------------------------------------
# Chave de API da OpenAI para geração de embeddings
# Usada para vetorização de documentos e busca semântica inteligente
# Modelo utilizado: text-embedding-3-small (1536 dimensões)
# Obtenha em: https://platform.openai.com/api-keys
# AI Services
OPENAI_API_KEY=sk-...

# Modelo de embedding a ser utilizado (padrão: text-embedding-3-small)
# Opções: text-embedding-3-small (1536 dims), text-embedding-3-large (3072 dims), text-embedding-ada-002 (1536 dims)
OPENAI_EMBEDDING_MODEL=text-embedding-3-small

# -----------------------------------------------------------------------------
# COHERE - Embeddings Alternativo (Opcional)
# -----------------------------------------------------------------------------
# Para usar Cohere em vez de OpenAI, defina AI_EMBEDDING_PROVIDER=cohere
# Obtenha em: https://dashboard.cohere.com/api-keys
# AI_EMBEDDING_PROVIDER=cohere
# COHERE_API_KEY=sua_chave_cohere
# COHERE_EMBEDDING_MODEL=embed-multilingual-v3.0

# -----------------------------------------------------------------------------
# AI INDEXING - Controle de Indexação RAG (Opcional)
# -----------------------------------------------------------------------------
# Habilita/desabilita indexação de documentos para busca semântica
# Em caso de emergência (Disk I/O alto), defina como false
# Padrão: true
ENABLE_AI_INDEXING=true

# -----------------------------------------------------------------------------
# CRON JOBS - Agendamentos Automáticos (Obrigatório para Scheduler)
# -----------------------------------------------------------------------------
# Secret token para autenticar chamadas de cron jobs
# Gere um token seguro: openssl rand -hex 32
#
# Os cron jobs são executados via pg_cron do Supabase, que faz HTTP POST
# para os endpoints protegidos:
#   - POST /api/cron/executar-agendamentos (scheduler de capturas)
#   - POST /api/cron/verificar-prazos (notificações de prazos)
#   - POST /api/cron/indexar-documentos (indexação RAG)
#
# Headers aceitos:
#   - Authorization: Bearer <CRON_SECRET>
#   - X-Cron-Secret: <CRON_SECRET>
#
# Configuração no Supabase:
#   1. Salvar secrets no Vault:
#      SELECT vault.create_secret('https://seu-dominio.com', 'app_url');
#      SELECT vault.create_secret('seu_cron_secret', 'cron_secret');
#   2. Criar cron job:
#      SELECT cron.schedule('nome-job', '* * * * *', $$ SELECT net.http_post(...) $$);
#   3. Ver jobs: SELECT * FROM cron.job;
#   4. Ver execuções: SELECT * FROM cron.job_run_details ORDER BY start_time DESC;
CRON_SECRET=seu_cron_secret_seguro

# -----------------------------------------------------------------------------
# DEBUG - Logs de Desenvolvimento (Opcional)
# -----------------------------------------------------------------------------
# Habilita logs legíveis para queries Supabase
# Exemplo: [Supabase] SELECT clientes (nome=JEFFERSON) 200 in 91ms
DEBUG_SUPABASE=false

# -----------------------------------------------------------------------------
# BUILD CACHE - Cache Persistente (Opcional)
# -----------------------------------------------------------------------------
# Habilita logs do cache handler customizado
# Mostra operacoes de get/set/revalidate do cache
# BUILD_CACHE_DEBUG=false

# -----------------------------------------------------------------------------
# REDIS - Cache Distribuído (Opcional)
# -----------------------------------------------------------------------------
# IMPORTANTE: Não inclua a senha na URL. Use REDIS_PASSWORD separadamente.
ENABLE_REDIS_CACHE=true
REDIS_URL=redis://host:6379
REDIS_PASSWORD=sua_senha
REDIS_CACHE_TTL=600
REDIS_CACHE_MAX_MEMORY=256mb
ENABLE_REDIS_LOG_STREAMING=false

# -----------------------------------------------------------------------------
# BROWSER SERVICE - Firefox para Scraping (Produção)
# -----------------------------------------------------------------------------
# Em produção: conecta ao Firefox remoto via WebSocket
# Em desenvolvimento: deixe vazio para usar Firefox local (fallback automático)
#
# Configure os endpoints do serviço de browser externo
# -----------------------------------------------------------------------------
BROWSER_WS_ENDPOINT=
BROWSER_SERVICE_URL=
BROWSER_SERVICE_TOKEN=

# -----------------------------------------------------------------------------
# MCP SERVER - Integração com Agentes IA
# -----------------------------------------------------------------------------
# Configurações para o MCP Server (dbos-mcp)
# Configure a URL do DBOS para o MCP conectar
# -----------------------------------------------------------------------------
MCP_DBOS_API_URL=http://localhost:3000
# Use o mesmo valor de SERVICE_API_KEY ou uma chave dedicada para o MCP
MCP_DBOS_API_KEY=sua_api_key_segura

# -----------------------------------------------------------------------------
# SECURITY - Headers de Segurança HTTP
# -----------------------------------------------------------------------------
# Modo report-only para CSP (não bloqueia, apenas reporta violações)
# Defina como false para ativar bloqueio após validação em produção
# Recomendação: manter true por pelo menos 1 semana em produção para identificar
# violações legítimas antes de ativar o modo enforcement
CSP_REPORT_ONLY=true

# URI para relatórios de violação CSP (opcional)
# CSP_REPORT_URI=/api/csp-report

# -----------------------------------------------------------------------------
# CORS - Controle de Origens Permitidas
# -----------------------------------------------------------------------------
# Lista de origens permitidas para requisições CORS (comma-separated)
# Em desenvolvimento, localhost é permitido automaticamente
# Em produção, defina explicitamente os domínios confiáveis
# Exemplo: https://advocaciadiegobarbosa.com.br,https://app.advocaciadiegobarbosa.com.br
# ALLOWED_ORIGINS=https://advocaciadiegobarbosa.com.br

# -----------------------------------------------------------------------------
# RATE LIMITING - Controle de Taxa de Requisições
# -----------------------------------------------------------------------------
# Modo de falha quando Redis está indisponível:
# - 'closed': Bloqueia requisições (mais seguro, padrão)
# - 'open': Permite requisições (mais disponível, menos seguro)
RATE_LIMIT_FAIL_MODE=closed

# -----------------------------------------------------------------------------
# IP BLOCKING - Bloqueio Automático de IPs Suspeitos
# -----------------------------------------------------------------------------
# Habilita/desabilita o sistema de bloqueio automático de IPs
# Padrão: true
IP_BLOCKING_ENABLED=true

# IPs sempre permitidos (comma-separated)
# Estes IPs nunca serão bloqueados automaticamente
IP_WHITELIST=127.0.0.1,::1

# Thresholds para bloqueio automático (opcional - usa padrões se não definido)
# IP_BLOCK_AUTH_FAILURES: Falhas de autenticação antes de bloquear (padrão: 5)
# IP_BLOCK_RATE_LIMIT_ABUSE: Rate limits excedidos antes de bloquear (padrão: 10)
# IP_BLOCK_INVALID_ENDPOINTS: Requisições a endpoints inválidos (padrão: 20)
# IP_BLOCK_AUTH_FAILURES=5
# IP_BLOCK_RATE_LIMIT_ABUSE=10
# IP_BLOCK_INVALID_ENDPOINTS=20

# -----------------------------------------------------------------------------
# ESTRUTURA DE URLs (Baseada em Diretórios)
# -----------------------------------------------------------------------------
# A aplicação usa roteamento baseado em diretórios (não domínios):
#
# - Website:        advocaciadiegobarbosa.com.br/          (raiz)
# - Dashboard:      advocaciadiegobarbosa.com.br/app       (requer auth Supabase)
# - Portal Cliente: advocaciadiegobarbosa.com.br/portal    (requer sessão CPF)
#
# No Cloudron: configure apenas UM domínio
# Todas as rotas funcionam automaticamente via paths

# -----------------------------------------------------------------------------
# SYSTEM AGENT - Configuração do Agente do Sistema
# -----------------------------------------------------------------------------
# ID do usuário que representa o agente do sistema no banco de dados
# Deve corresponder a um usuário de serviço existente
# Padrão: 1
SYSTEM_AGENT_USER_ID=1

# syntax=docker/dockerfile:1
# Dockerfile.test - Testing Environment
# Includes all dependencies for running tests (Jest, Playwright client)

FROM node:22-alpine

WORKDIR /app

ENV NODE_ENV=test
ENV NEXT_TELEMETRY_DISABLED=1
ENV PLAYWRIGHT_SKIP_BROWSER_DOWNLOAD=1

# Compatibilidade glibc e ferramentas necessarias para testes
RUN apk add --no-cache git bash libc6-compat

COPY package.json package-lock.json* ./

# --legacy-peer-deps necessario para resolver conflitos de peer deps do projeto
RUN npm ci --legacy-peer-deps

COPY . .

# Run build if tests depend on built artifacts (optional, usually jest doesn't need full build)
# RUN npm run build

CMD ["npm", "run", "test:ci"]

name: Cron - Agendamentos Captura

on:
  schedule:
    # GitHub Actions não garante execução a cada minuto; usamos 5 min como padrão.
    - cron: '*/5 * * * *'
  workflow_dispatch: {}

jobs:
  executar-agendamentos:
    name: Executar agendamentos de captura
    runs-on: ubuntu-latest
    timeout-minutes: 6

    steps:
      - name: Executar scheduler de agendamentos
        run: |
          curl -X POST "${{ secrets.APP_URL }}/api/cron/executar-agendamentos" \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -w "\n\nStatus: %{http_code}\n" \
            --retry 3 \
            --retry-delay 5 \
            --retry-max-time 30 \
            --connect-timeout 10 \
            --max-time 320 \
            -f
